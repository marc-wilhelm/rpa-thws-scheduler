<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THWS Scheduler</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="page-layout">
    <div class="content-block">
        <h1>THWS Scheduler</h1>
        <h2>Business School</h2>

        <div id="options">
            <div class="option-card" onclick="selectOption('scrape')">
                <div class="option-title">Vorlesungsplan importieren/aktualisieren</div>
                <div class="option-description">Stellt eine Anfrage an die API, welche alle angegebenen Vorlesungspläne nach Modulen absucht (scrapt) und anschließend als JSON zurückgibt. Über diese JSON-Struktur wird dann iteriert, um alle Tage und Vorlesungen zu bekommen, wobei anschließend für jede Vorlesung ein Termin im Kalender neu eingetragen oder aktualisiert wird.</div>
            </div>

            <div class="option-card" onclick="selectOption('clear')">
                <div class="option-title">Kalender leeren</div>
                <div class="option-description">Löscht alle vorhandenen Termine aus deinem Kalender.</div>
            </div>
        </div>

        <!-- Neuer Bereich für Request-Content bei Scrape -->
        <div id="scrape-config" class="config-section" style="display: none;">
            <h3>Konfiguration für Vorlesungsplan</h3>
            
            <div id="vlplan-selection-container" class="selection-display">
                <div class="selection-info">
                    <span>Ausgewählter Vorlesungsplan:</span>
                    <span id="selected-vlplan">Kein Vorlesungsplan ausgewählt</span>
                    <button id="reset-vlplan-selection" style="display: none;">Zurücksetzen</button>
                </div>
                <button id="vlplan-toggle-button" class="toggle-button">Vorlesungspläne anzeigen</button>
            </div>
            
            <!-- Verstecktes Feld für die ausgewählte Vorlesungsplan-URL -->
            <input type="hidden" id="vlplan-url-input" name="vlplan-url">
            
            <!-- Ausklappbarer Bereich für Vorlesungsplan-Suche -->
            <div id="vlplan-config" class="vlplan-section collapsed">
                <div class="vlplan-search-container">
                    <input type="text" id="vlplan-search-input" placeholder="Studiengang suchen...">
                </div>
                
                <div id="vlplan-loader" style="display: none;">
                    <div class="spinner"></div>
                    <span>Lade Vorlesungspläne...</span>
                </div>
                
                <div id="vlplan-error" style="display: none;"></div>
                
                <div id="vlplan-programs-container"></div>
            </div>
            
            <div class="input-tabs">
                <div class="tab-button active" onclick="switchTab('structured')">Strukturierte Eingabe</div>
                <div class="tab-button" onclick="switchTab('raw')">JSON (RAW)</div>
            </div>
            
            <!-- Strukturierte Eingabe -->
            <div id="structured-input" class="input-panel">
                <div id="plans-container">
                    <div class="plan-item">
                        <div class="input-group">
                            <label for="plan-url-0">URL:</label>
                            <input type="text" id="plan-url-0" class="plan-url" placeholder="z.B. https://business.thws.de/fileadmin/share/vlplan/BBA%206%20SS%2025.html">
                        </div>
                        <div class="input-group">
                            <label for="plan-label-0">Label:</label>
                            <input type="text" id="plan-label-0" class="plan-label" placeholder="z.B. BBA 6">
                        </div>
                        <div class="input-group">
                            <label for="plan-filter-0">Filter (durch Komma getrennt):</label>
                            <input type="text" id="plan-filter-0" class="plan-filter" placeholder="z.B. PBA1, SPBA">
                        </div>
                        <button class="remove-plan" onclick="removePlan(0)" style="display: none;">Entfernen</button>
                    </div>
                </div>
                <button class="add-plan-button" onclick="addPlan()">+ Plan hinzufügen</button>
            </div>
            
            <!-- JSON RAW Eingabe -->
            <div id="raw-input" class="input-panel" style="display: none;">
                <textarea id="json-input" placeholder='z.B.:
{
  "plans": [
    {
      "url": "https://business.thws.de/fileadmin/share/vlplan/BBA%206%20SS%2025.html",
      "label": "BBA 6",
      "filter": ["PBA1", "SPBA"]
    }
  ]
}'></textarea>
                <div class="json-validation" id="json-validation"></div>
            </div>
        </div>

        <button id="execute" class="execute-button" disabled onclick="executeAction()">Ausführen</button>

        <div id="status" class="status"></div>
    </div>

    <div class="content-block">
        <h3>API Info</h3>
        <p><strong>URL:</strong><br><code>https://thws-scheduler.azurewebsites.net/api/schedule_scraper</code></p>

        <h4>Content-Request Format:</h4>
        <pre>{
  "plans": [
    {
      "url": "https://business.thws.de/fileadmin/share/vlplan/BBA%206%20SS%2025.html",
      "label": "BBA 6",
      "filter": ["PBA1", "SPBA"]
    },
    {
      "url": "https://business.thws.de/fileadmin/share/vlplan/BBW%206%20SS%2025.html",
      "label": "BBW 6",
      "filter": ["SP WINF"]
    }
  ]
}</pre>
    </div>
</div>

<footer class="footer">
    <div class="footer-content">
        <p>Dieses Projekt ist rein privat und steht in keiner Verbindung zu Dritten.<br>Alle Marken- und Namensrechte verbleiben bei ihren jeweiligen Eigentümern.</p>
    </div>
</footer>

<script src="script.js"></script>
<script src="vlplan-scraper.js"></script>
</body>
</html>
